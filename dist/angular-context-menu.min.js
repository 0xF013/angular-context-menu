angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(t,e,n,o,r,a,i){return function(l){function u(t,e,n){return this.target=t,v&&e&&f(e),g.then(function(t){return $||c(t,e),n&&$.css(n),$})}function c(t,e){if(x=angular.element(l.container||document.body),$=angular.element(t),0===$.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter($,x),v=a.$new(),e&&f(e);var o=i(d,{$scope:v});h&&(v[h]=o),n($)(v)}function f(t){for(var e in t)v[e]=t[e]}function p(t){$&&$.css(t)}function s(){var e=t.defer();return $?(r.leave($,function(t){v.$destroy(),e.resolve(),t&&t.focus()}(this.target)),$=null):e.resolve(),e.promise}function m(){return!!$}if(!(!l.template^!l.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var g,v,d=(l.template,l.controller||angular.noop),h=l.controllerAs,$=null,x=null;if(l.template){var y=t.defer();y.resolve(l.template),g=y.promise}else g=e.get(l.templateUrl,{cache:o}).then(function(t){return t.data});return{open:u,close:s,active:m,reposition:p}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout",function(t,e){return{restrict:"A",link:function(n,o,r){function a(t){var e={},n=angular.element(t),o=n[0].getBoundingClientRect();return e.top=o.top,e.left=o.left,e}function i(t,e){var n={};return n.offsetY=e.top-t.top,n.offsetX=e.left-t.left,n}function l(t){var e=a(t.target),n=c(t),o=d.open(t.target,h,f(t));o.then(function(t){angular.element(t).trap()}),g=t.target,v=i(e,n)}function u(){d.close()}function c(t){var e={};if(t.pageX&&t.pageY)e.top=Math.max(t.pageY,0),e.left=Math.max(t.pageX,0);else{var n=angular.element(t.target)[0].getBoundingClientRect();e.top=Math.max(n.bottom,0),e.left=Math.max(n.left,0)}return e}function f(t){var e=c(t);return e.top+="px",e.left+="px",e}function p(t){t.preventDefault(),t.stopPropagation(),n.$apply(function(){l(t)})}function s(){n.$apply(function(){u()})}function m(t){d.active()&&2!==t.button&&s()}var g,v,d=t.get(r.target),h={},$=angular.element(e),x=r.triggerOnEvent||"contextmenu";if(r.locals){var y=r.locals.split(",").map(function(t){return t.trim()});angular.forEach(y,function(t){h[t]=n[t]})}o.bind(x,function(t){p(t)}),o.bind("keyup",function(t){121===t.keyCode&&t.shiftKey&&t.altKey&&(d.active()||p(t))}),$.bind("click",m),$.bind(x,m),$.bind("keyup",function(){d.active()&&27===event.keyCode&&s()}),$.on("resize",function(){if(g){var t=a(g),e={top:t.top+v.offsetY,left:t.left+v.offsetX};d.reposition(e),lastTargetPosition=t}})}}}]);