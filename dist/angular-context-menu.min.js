angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$timeout","$compile","$templateCache","$animate","$rootScope","$controller",function(t,e,n,o,r,a,i,l){return function(n){function u(t,e,n){return this.target=t,h&&e&&f(e),m.then(function(t){return $||(c(t,e),a.enabled(!1,$)),n&&$.css(n),$.appendTo(x),$})}function c(t,e){if(x=angular.element(n.container||document.body),$=angular.element(t),0===$.length)throw new Error("The template contains no elements; you need to wrap text nodes");h=i.$new(),e&&f(e);var r=l(v,{$scope:h});d&&(h[d]=r),o($)(h)}function f(t){for(var e in t)h[e]=t[e]}function p(t){$&&$.css(t)}function s(){var e=t.defer();return $?(h.$destroy(),e.resolve(),$.remove(),this.target&&this.target.focus(),$=null):e.resolve(),e.promise}function g(){return!!$}if(!(!n.template^!n.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var m,h,v=(n.template,n.controller||angular.noop),d=n.controllerAs,$=null,x=null;if(n.template){var b=t.defer();b.resolve(n.template),m=b.promise}else m=e.get(n.templateUrl,{cache:r}).then(function(t){return t.data});return{open:u,close:s,active:g,reposition:p}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout","$animate",function(t,e){return{restrict:"A",link:function(n,o,r){function a(t){var e={},n=angular.element(t),o=n[0].getBoundingClientRect();return e.top=o.top,e.left=o.left,e}function i(t,e){var n={};return n.offsetY=e.top-t.top,n.offsetX=e.left-t.left,n}function l(t){var e=a(t.target),n=f(t),o=d.open(t.target,$,p(t));h=t.target,v=i(e,n),o.then(function(t){angular.element(t).trap(),u(t,n)})}function u(t,e){var n={top:x.scrollTop(),left:x.scrollLeft()};n.right=n.left+x.width(),n.bottom=n.top+x.height();var o=t.offset();o.right=o.left+t.outerWidth(),o.bottom=o.top+t.outerHeight(),n.right<o.right&&t.css("left",e.left-t.outerWidth()),n.bottom<o.bottom&&t.css("top",e.top-t.outerHeight())}function c(){d.close()}function f(t){var e={};if(t.pageX&&t.pageY)e.top=Math.max(t.pageY,0),e.left=Math.max(t.pageX,0);else{var n=angular.element(t.target)[0].getBoundingClientRect();e.top=Math.max(n.bottom,0),e.left=Math.max(n.left,0)}return e}function p(t){var e=f(t);return e.top+="px",e.left+="px",e}function s(t){t.preventDefault(),t.stopPropagation(),n.$apply(function(){l(t)})}function g(){n.$apply(function(){c()})}function m(t){d.active()&&2!==t.button&&g()}var h,v,d=t.get(r.target),$={},x=angular.element(e),b=r.triggerOnEvent||"contextmenu";if(r.locals){var y=r.locals.split(",").map(function(t){return t.trim()});angular.forEach(y,function(t){$[t]=n[t]})}o.bind(b,function(t){s(t)}),o.bind("keyup",function(t){121===t.keyCode&&t.shiftKey&&t.altKey&&(d.active()||s(t))}),x.bind("click",m),x.bind(b,m),x.bind("keyup",function(t){d.active()&&27===t.keyCode&&g()}),x.on("resize",function(){if(h){var t=a(h),e={top:t.top+v.offsetY,left:t.left+v.offsetX};d.reposition(e),lastTargetPosition=t}})}}}]);