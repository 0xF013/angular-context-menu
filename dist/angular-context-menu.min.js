angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,a,l){return function(i){function u(e,t,n){return this.target=e,g&&t&&p(t),s.then(function(e){return d||c(e,t),n&&d.css(n),d})}function c(e,t){if(x=angular.element(i.container||document.body),d=angular.element(e),0===d.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter(d,x),g=a.$new(),t&&p(t);var o=l(v,{$scope:g});h&&(g[h]=o),n(d)(g)}function p(e){for(var t in e)g[t]=e[t]}function f(){var t=e.defer();return d?(r.leave(d,function(e){g.$destroy(),t.resolve(),e&&e.focus()}(this.target)),d=null):t.resolve(),t.promise}function m(){return!!d}if(!(!i.template^!i.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var s,g,v=(i.template,i.controller||angular.noop),h=i.controllerAs,d=null,x=null;if(i.template){var $=e.defer();$.resolve(i.template),s=$.promise}else s=t.get(i.templateUrl,{cache:o}).then(function(e){return e.data});return{open:u,close:f,active:m}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout",function(e,t){return{restrict:"A",link:function(n,o,r){function a(e){var t=f.open(e.target,m,i(e));t.then(function(e){angular.element(e).trap()})}function l(){f.close()}function i(e){var t={};if(e.pageX&&e.pageY)t.top=Math.max(e.pageY,0)+"px",t.left=Math.max(e.pageX,0)+"px";else{var n=angular.element(e.target)[0].getBoundingClientRect();t.top=Math.max(n.bottom,0)+"px",t.left=Math.max(n.left,0)+"px"}return t}function u(e){e.preventDefault(),e.stopPropagation(),n.$apply(function(){a(e)})}function c(){n.$apply(function(){l()})}function p(e){f.active()&&2!==e.button&&c()}var f=e.get(r.target),m={},s=angular.element(t),g=r.triggerOnEvent||"contextmenu";if(r.locals){var v=r.locals.split(",").map(function(e){return e.trim()});angular.forEach(v,function(e){m[e]=n[e]})}o.bind(g,function(e){u(e)}),o.bind("keyup",function(e){121===e.keyCode&&e.shiftKey&&e.altKey&&(f.active()||u(e))}),s.bind("click",p),s.bind(g,p),s.bind("keyup",function(){f.active()&&27===event.keyCode&&c()})}}}]);