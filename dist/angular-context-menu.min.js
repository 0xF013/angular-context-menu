angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$timeout","$compile","$templateCache","$animate","$rootScope","$controller",function(t,e,n,o,r,i,a,l){return function(u){function c(t,e,o){return this.target=t,v&&e&&p(e),h.then(function(t){return b||f(t,e),o&&b.css(o),b.css("visibility","hidden"),i.enter(b,y).then(function(){n(function(){b.css("visibility","visible")})}),b})}function f(t,e){if(y=angular.element(u.container||document.body),b=angular.element(t),0===b.length)throw new Error("The template contains no elements; you need to wrap text nodes");v=a.$new(),e&&p(e);var n=l(d,{$scope:v});$&&(v[$]=n),o(b)(v)}function p(t){for(var e in t)v[e]=t[e]}function s(t){b&&b.css(t)}function g(){var e=t.defer();return b?(i.leave(b).then(function(){v.$destroy(),e.resolve()}),this.target&&this.target.focus(),b=null):e.resolve(),e.promise}function m(){return!!b}if(!(!u.template^!u.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var h,v,d=(u.template,u.controller||angular.noop),$=u.controllerAs,b=null,y=null;if(u.template){var x=t.defer();x.resolve(u.template),h=x.promise}else h=e.get(u.templateUrl,{cache:r}).then(function(t){return t.data});return{open:c,close:g,active:m,reposition:s}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout","$animate",function(t,e,n,o,r){return{restrict:"A",link:function(n,o,i){function a(t){var e={},n=angular.element(t),o=n[0].getBoundingClientRect();return e.top=o.top,e.left=o.left,e}function l(t,e){var n={};return n.offsetY=e.top-t.top,n.offsetX=e.left-t.left,n}function u(t){var e=a(t.target),n=p(t),o=$.open(t.target,b,s(t));o.then(function(t){angular.element(t).trap(),r.enter(t,document.body,t).then(function(){c(t,n)})}),v=t.target,d=l(e,n)}function c(t,e){var n={top:y.scrollTop(),left:y.scrollLeft()};n.right=n.left+y.width(),n.bottom=n.top+y.height();var o=t.offset();o.right=o.left+t.outerWidth(),o.bottom=o.top+t.outerHeight(),n.right<o.right&&t.css("left",e.left-t.outerWidth()),n.bottom<o.bottom&&t.css("top",e.top-t.outerHeight())}function f(){$.close()}function p(t){var e={};if(t.pageX&&t.pageY)e.top=Math.max(t.pageY,0),e.left=Math.max(t.pageX,0);else{var n=angular.element(t.target)[0].getBoundingClientRect();e.top=Math.max(n.bottom,0),e.left=Math.max(n.left,0)}return e}function s(t){var e=p(t);return e.top+="px",e.left+="px",e}function g(t){t.preventDefault(),t.stopPropagation(),n.$apply(function(){u(t)})}function m(){n.$apply(function(){f()})}function h(t){$.active()&&2!==t.button&&m()}var v,d,$=t.get(i.target),b={},y=angular.element(e),x=i.triggerOnEvent||"contextmenu";if(i.locals){var w=i.locals.split(",").map(function(t){return t.trim()});angular.forEach(w,function(t){b[t]=n[t]})}o.bind(x,function(t){g(t)}),o.bind("keyup",function(t){121===t.keyCode&&t.shiftKey&&t.altKey&&($.active()||g(t))}),y.bind("click",h),y.bind(x,h),y.bind("keyup",function(t){$.active()&&27===t.keyCode&&m()}),y.on("resize",function(){if(v){var t=a(v),e={top:t.top+d.offsetY,left:t.left+d.offsetX};$.reposition(e),lastTargetPosition=t}})}}}]);